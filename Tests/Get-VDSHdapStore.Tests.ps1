$ScriptName = $MyInvocation.MyCommand.Name
$ScriptPath = $PSScriptRoot
$ScriptUnderTest = if($ScriptName.EndsWith(".Tests.ps1")) { $ScriptName.Replace(".Tests.ps1", ".ps1") }
$TestScriptPath = Resolve-Path $ScriptPath\..\VDS\Public
$FunctionName = $ScriptUnderTest.Replace(".ps1", "")

. "$TestScriptPath\$ScriptUnderTest"

Describe "Unit Test: $FunctionName" {
    It "Test $FunctionName`: Return true is all expected object attributes exist." {

        $JsonObject = '{"914d3436-0f5f-4239-a76d-bcaaab111c95":{"dc=int,dc=asurion,dc=com":{"numOfEntries":"188516","writeOps":"0.0","numOfEntriesPeak":"188516","indexName":"dc=int,dc=asurion,dc=com","searchOps":"0.0","indexSizePeak":"3698934.095703125","writeOpsPeak":"0.0","folderSize":"2135712792","searchOpsPeak":"0.4","version":"dd73","indexSize":"2065125.0234375"},"ou=asurionmailbox,o=view":{"numOfEntries":"34148","writeOps":"0.0","numOfEntriesPeak":"34148","indexName":"ou=asurionmailbox,o=view","searchOps":"0.0","indexSizePeak":"122198.787109375","writeOpsPeak":"0.0","folderSize":"141994686","searchOpsPeak":"0.0","version":"1d3","indexSize":"118178.685546875"},"ou=azure,ou=sso,o=view":{"numOfEntries":"41304","writeOps":"0.0","numOfEntriesPeak":"41304","indexName":"ou=azure,ou=sso,o=view","searchOps":"0.0","indexSizePeak":"166067.93359375","writeOpsPeak":"0.0","folderSize":"189328663","searchOpsPeak":"4.4","version":"8c1","indexSize":"164379.2724609375"},"dc=newcorp,dc=com":{"numOfEntries":"49000","writeOps":"0.0","numOfEntriesPeak":"49000","indexName":"dc=newcorp,dc=com","searchOps":"0.0","indexSizePeak":"512346.7333984375","writeOpsPeak":"0.0","folderSize":"462159980","searchOpsPeak":"26.8","version":"74db","indexSize":"430796.10546875"},"dc=asurion,dc=org":{"numOfEntries":"74677","writeOps":"0.0","numOfEntriesPeak":"74677","indexName":"dc=asurion,dc=org","searchOps":"0.39872408293460926","indexSizePeak":"903749.1328125","writeOpsPeak":"0.0","folderSize":"849571794","searchOpsPeak":"0.8","version":"278a","indexSize":"809127.955078125"},"ou=dn,o=view":{"numOfEntries":"260914","writeOps":"0.0","numOfEntriesPeak":"260914","indexName":"ou=dn,o=view","searchOps":"0.0","indexSizePeak":"484299.47265625","writeOpsPeak":"0.0","folderSize":"508971934","searchOpsPeak":"0.0","version":"5657","indexSize":"476542.904296875"},"o=asurion":{"numOfEntries":"216780","writeOps":"0.0","numOfEntriesPeak":"216780","indexName":"o=asurion","searchOps":"2.1995600879824035","indexSizePeak":"2436699.4716796875","writeOpsPeak":"0.0","folderSize":"1380388471","searchOpsPeak":"21.929824561403507","version":"f45d","indexSize":"1327507.6162109375"},"o=sid":{"numOfEntries":"377571","writeOps":"0.0","numOfEntriesPeak":"377571","indexName":"o=sid","searchOps":"0.0","indexSizePeak":"729574.056640625","writeOpsPeak":"0.0","folderSize":"701926033","searchOpsPeak":"0.0","version":"db2e","indexSize":"664970.6416015625"},"cn=changelog":{"numOfEntries":"170693","writeOps":"0.0","numOfEntriesPeak":"170693","indexName":"cn=changelog","searchOps":"0.0","indexSizePeak":"3091612.78125","writeOpsPeak":"0.0","folderSize":"1251511350","searchOpsPeak":"0.0","version":"295126","indexSize":"1316259.2763671875"}},"aaeccabc-7af2-4fcf-b2db-020690112f5c":{"dc=int,dc=asurion,dc=com":{"numOfEntries":"188516","writeOps":"0.4","numOfEntriesPeak":"188516","indexName":"dc=int,dc=asurion,dc=com","searchOps":"2.2","indexSizePeak":"3464377.3623046875","writeOpsPeak":"36.874626270679684","folderSize":"4537835207","searchOpsPeak":"496.3007398520296","version":"dd73","indexSize":"2065499.345703125"},"ou=asurionmailbox,o=view":{"numOfEntries":"34148","writeOps":"0.0","numOfEntriesPeak":"34148","indexName":"ou=asurionmailbox,o=view","searchOps":"0.0","indexSizePeak":"123139.357421875","writeOpsPeak":"97.60000000000001","folderSize":"141906699","searchOpsPeak":"2149.4","version":"1d3","indexSize":"118084.7607421875"},"ou=azure,ou=sso,o=view":{"numOfEntries":"41304","writeOps":"0.0","numOfEntriesPeak":"41304","indexName":"ou=azure,ou=sso,o=view","searchOps":"0.18726591760299627","indexSizePeak":"240148.0185546875","writeOpsPeak":"176.4","folderSize":"187796695","searchOpsPeak":"7.192807192807193","version":"8c1","indexSize":"162863.2099609375"},"dc=newcorp,dc=com":{"numOfEntries":"49000","writeOps":"0.0","numOfEntriesPeak":"49000","indexName":"dc=newcorp,dc=com","searchOps":"0.0","indexSizePeak":"512323.5234375","writeOpsPeak":"19.0","folderSize":"961186616","searchOpsPeak":"164.56708658268346","version":"74db","indexSize":"429632.1357421875"},"dc=asurion,dc=org":{"numOfEntries":"74677","writeOps":"0.0","numOfEntriesPeak":"74677","indexName":"dc=asurion,dc=org","searchOps":"0.34441191665231613","indexSizePeak":"920911.248046875","writeOpsPeak":"21.795640871825633","folderSize":"1958851558","searchOpsPeak":"472.1055788842232","version":"278a","indexSize":"808375.34375"},"ou=dn,o=view":{"numOfEntries":"260914","writeOps":"0.0","numOfEntriesPeak":"260914","indexName":"ou=dn,o=view","searchOps":"0.0","indexSizePeak":"516613.48046875","writeOpsPeak":"20.0","folderSize":"508647479","searchOpsPeak":"182.52698920431828","version":"5657","indexSize":"476214.0537109375"},"o=asurion":{"numOfEntries":"216780","writeOps":"0.0","numOfEntriesPeak":"216780","indexName":"o=asurion","searchOps":"2.067280586355948","indexSizePeak":"3501359.021484375","writeOpsPeak":"219.75604879024198","folderSize":"1380106486","searchOpsPeak":"31.761885737115463","version":"f45d","indexSize":"1327228.240234375"},"o=sid":{"numOfEntries":"377571","writeOps":"0.0","numOfEntriesPeak":"377571","indexName":"o=sid","searchOps":"0.0","indexSizePeak":"729580.0185546875","writeOpsPeak":"21.96485623003195","folderSize":"701231046","searchOpsPeak":"1177.7733439744613","version":"db2e","indexSize":"664271.943359375"},"cn=changelog":{"numOfEntries":"170695","writeOps":"0.0","numOfEntriesPeak":"170695","indexName":"cn=changelog","searchOps":"1.187178472497032","indexSizePeak":"3091439.767578125","writeOpsPeak":"0.4","folderSize":"1368390128","searchOpsPeak":"13.57556398482731","version":"295126","indexSize":"1316268.484375"}},"a80969d3-0f8c-4e0f-9a09-0579e92023f1":{"dc=int,dc=asurion,dc=com":{"numOfEntries":"188516","writeOps":"0.0","numOfEntriesPeak":"188516","indexName":"dc=int,dc=asurion,dc=com","searchOps":"0.0","indexSizePeak":"3788971.47265625","writeOpsPeak":"0.0","folderSize":"1819302799","searchOpsPeak":"0.8","version":"dd73","indexSize":"2065125.0234375"},"ou=asurionmailbox,o=view":{"numOfEntries":"34148","writeOps":"0.0","numOfEntriesPeak":"34148","indexName":"ou=asurionmailbox,o=view","searchOps":"0.0","indexSizePeak":"121043.072265625","writeOpsPeak":"0.0","folderSize":"141994686","searchOpsPeak":"0.0","version":"1d3","indexSize":"118178.685546875"},"ou=azure,ou=sso,o=view":{"numOfEntries":"41304","writeOps":"0.0","numOfEntriesPeak":"41304","indexName":"ou=azure,ou=sso,o=view","searchOps":"0.0","indexSizePeak":"218933.1103515625","writeOpsPeak":"0.0","folderSize":"189340951","searchOpsPeak":"9.0","version":"8c1","indexSize":"164379.2724609375"},"dc=newcorp,dc=com":{"numOfEntries":"49000","writeOps":"0.0","numOfEntriesPeak":"49000","indexName":"dc=newcorp,dc=com","searchOps":"0.0","indexSizePeak":"512346.7333984375","writeOpsPeak":"0.0","folderSize":"462139500","searchOpsPeak":"23.400000000000002","version":"74db","indexSize":"430796.10546875"},"dc=asurion,dc=org":{"numOfEntries":"74677","writeOps":"0.0","numOfEntriesPeak":"74677","indexName":"dc=asurion,dc=org","searchOps":"0.4","indexSizePeak":"1093334.228515625","writeOpsPeak":"0.0","folderSize":"849563602","searchOpsPeak":"1.2","version":"278a","indexSize":"809127.955078125"},"ou=dn,o=view":{"numOfEntries":"260914","writeOps":"0.0","numOfEntriesPeak":"260914","indexName":"ou=dn,o=view","searchOps":"0.0","indexSizePeak":"516527.03125","writeOpsPeak":"0.0","folderSize":"508971934","searchOpsPeak":"0.0","version":"5657","indexSize":"476542.904296875"},"o=asurion":{"numOfEntries":"216780","writeOps":"0.0","numOfEntriesPeak":"216780","indexName":"o=asurion","searchOps":"0.0","indexSizePeak":"2648605.4814453125","writeOpsPeak":"0.0","folderSize":"1380388471","searchOpsPeak":"32.30309072781655","version":"f45d","indexSize":"1327507.6162109375"},"o=sid":{"numOfEntries":"377571","writeOps":"0.0","numOfEntriesPeak":"377571","indexName":"o=sid","searchOps":"0.0","indexSizePeak":"729574.056640625","writeOpsPeak":"0.0","folderSize":"701917841","searchOpsPeak":"0.0","version":"db2e","indexSize":"664970.6416015625"},"cn=changelog":{"numOfEntries":"170693","writeOps":"0.0","numOfEntriesPeak":"170693","indexName":"cn=changelog","searchOps":"0.0","indexSizePeak":"3021363.8583984375","writeOpsPeak":"0.0","folderSize":"1206550688","searchOpsPeak":"15.749601275917065","version":"295126","indexSize":"1316259.2763671875"}}}'

        mock 'Invoke-VDSAdminAPIRestMethod' -MockWith { $JsonObject | ConvertFrom-Json}
        
        $Result = Get-VDSHdapStore -Server 'vds.prod.asurion.net'
        $PropList = $Result | Get-Member | Where-Object MemberType -eq 'NoteProperty' | Select-Object -ExpandProperty Name

        $PropList -contains 'Name' | Should -BeTrue
        $PropList -contains 'CloudId' | Should -BeTrue
        $PropList -contains 'NamingContext' | Should -BeTrue
        $PropList -contains 'numOfEntries' | Should -BeTrue
        $PropList -contains 'writeOps' | Should -BeTrue
        $PropList -contains 'numOfEntriesPeak' | Should -BeTrue
        $PropList -contains 'indexName' | Should -BeTrue
        $PropList -contains 'searchOps' | Should -BeTrue
        $PropList -contains 'indexSizePeak' | Should -BeTrue
        $PropList -contains 'writeOpsPeak' | Should -BeTrue
        $PropList -contains 'folderSize' | Should -BeTrue
        $PropList -contains 'searchOpsPeak' | Should -BeTrue
        $PropList -contains 'version' | Should -BeTrue
        $PropList -contains 'indexSize' | Should -BeTrue
    }
}