$ScriptName = $MyInvocation.MyCommand.Name
$ScriptPath = $PSScriptRoot
$ScriptUnderTest = if($ScriptName.EndsWith(".Tests.ps1")) { $ScriptName.Replace(".Tests.ps1", ".ps1") }
$TestScriptPath = Resolve-Path $ScriptPath\..\VDS\Public
$FunctionName = $ScriptUnderTest.Replace(".ps1", "")

. "$TestScriptPath\$ScriptUnderTest"

Describe "Unit Test: $FunctionName" {
    It "Test $FunctionName`: Results should not be empty or null." {
        
        $JsonObject = '{"CF_DC_NEWCORP_DC_COM":{"generic (so_dc_newcorp_dc_com)":{"connectorType":"Capture [AD]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"61472"},"cacherefresh (so_vdsconnector)":{"connectorType":"Apply [LDAP]","totalMsgsProcessedByApply":"61472","applyState":"started","totalMsgsProcessedByCapture":"0"},"from_generic_to_cacherefresh.java":{"source":"generic (so_dc_newcorp_dc_com)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"61472"}},"CF_DC_ASURION_DC_ORG":{"generic (so_dc_asurion_dc_org)":{"connectorType":"Capture [AD]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"23159"},"cacherefresh (so_vdsconnector)":{"connectorType":"Apply [LDAP]","totalMsgsProcessedByApply":"23162","applyState":"started","totalMsgsProcessedByCapture":"0"},"from_generic_to_cacherefresh.java":{"source":"generic (so_dc_asurion_dc_org)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"23159"}},"CF_DC_INT_DC_ASURION_DC_COM":{"generic (so_dc_int_dc_asurion_dc_com)":{"connectorType":"Capture [AD]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"71119"},"cacherefresh (so_vdsconnector)":{"connectorType":"Apply [LDAP]","totalMsgsProcessedByApply":"71128","applyState":"started","totalMsgsProcessedByCapture":"0"},"from_generic_to_cacherefresh.java":{"source":"generic (so_dc_int_dc_asurion_dc_com)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"71119"}},"CF_O_SID":{"group (so_dc_asurion_dc_org_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"3415"},"cacherefresh (so_vdsconnector)":{"connectorType":"Apply [LDAP]","totalMsgsProcessedByApply":"100846","applyState":"started","totalMsgsProcessedByCapture":"0"},"user (so_dc_asurion_dc_org_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"7515"},"group (so_dc_int_dc_asurion_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"2018"},"group (so_dc_newcorp_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"259"},"user (so_dc_newcorp_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"28713"},"user (so_dc_int_dc_asurion_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"58926"},"from_group_to_cacherefresh.java":{"source":"group (so_dc_asurion_dc_org_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"3415"},"from_user_to_cacherefresh.java":{"source":"user (so_dc_asurion_dc_org_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"7515"},"from_group1_to_cacherefresh.java":{"source":"group (so_dc_int_dc_asurion_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"2018"},"from_group2_to_cacherefresh.java":{"source":"group (so_dc_newcorp_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"259"},"from_user2_to_cacherefresh.java":{"source":"user (so_dc_newcorp_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"28713"},"from_user1_to_cacherefresh.java":{"source":"user (so_dc_int_dc_asurion_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"58926"}},"CF_OU_DN_O_VIEW":{"group (so_dc_asurion_dc_org_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"3448"},"cacherefresh (so_vdsconnector)":{"connectorType":"Apply [LDAP]","totalMsgsProcessedByApply":"104539","applyState":"started","totalMsgsProcessedByCapture":"0"},"user (so_dc_asurion_dc_org_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"7756"},"group (so_dc_int_dc_asurion_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"1999"},"group (so_dc_newcorp_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"244"},"user (so_dc_newcorp_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"28730"},"user (so_dc_int_dc_asurion_dc_com_custom)":{"connectorType":"Capture [LDAP]","captureState":"started","totalMsgsProcessedByApply":"0","totalMsgsProcessedByCapture":"62362"},"from_group_to_cacherefresh.java":{"source":"group (so_dc_asurion_dc_org_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"3448"},"from_user_to_cacherefresh.java":{"source":"user (so_dc_asurion_dc_org_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"7756"},"from_group1_to_cacherefresh.java":{"source":"group (so_dc_int_dc_asurion_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"1999"},"from_group2_to_cacherefresh.java":{"source":"group (so_dc_newcorp_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"244"},"from_user2_to_cacherefresh.java":{"source":"user (so_dc_newcorp_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"28730"},"from_user1_to_cacherefresh.java":{"source":"user (so_dc_int_dc_asurion_dc_com_custom)","state":"started","target":"cacherefresh (so_vdsconnector)","totalMsgsProcessed":"62362"}}}'

        mock 'Invoke-VDSAdminAPIRestMethod' -MockWith { $JsonObject | ConvertFrom-Json}
        
        $Result = Get-VDSIcsSync -Server 'vds.prod.asurion.net'
        $Result | Should -Not -BeNullOrEmpty
    }
}
