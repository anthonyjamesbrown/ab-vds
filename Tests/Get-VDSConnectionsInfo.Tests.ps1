$ScriptName = $MyInvocation.MyCommand.Name
$ScriptPath = $PSScriptRoot
$ScriptUnderTest = if($ScriptName.EndsWith(".Tests.ps1")) { $ScriptName.Replace(".Tests.ps1", ".ps1") }
$TestScriptPath = Resolve-Path $ScriptPath\..\VDS\Public
$FunctionName = $ScriptUnderTest.Replace(".ps1", "")

. "$TestScriptPath\$ScriptUnderTest"

Describe "Unit Test: $FunctionName" {
    It "Test $FunctionName`:   " {

        $JsonObject = '{"914d3436-0f5f-4239-a76d-bcaaab111c95":{"139849":{"opCountSearch":"20717","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"53429","opCountBind":"4334","opCountModify":"0","connBindDn":"cn=HQDOMAIN_Cherry.Cordoba,ou=users,o=asurion","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.179","connId":"139849","opCount":"25051","opCountDelete":"0","connServerPort":"636"},"139847":{"opCountSearch":"20688","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"53425","opCountBind":"4378","opCountModify":"0","connBindDn":"cn=HQDOMAIN_Shanah.Mosley,ou=wstrust,ou=azure,ou=sso,o=view","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.179","connId":"139847","opCount":"25066","opCountDelete":"0","connServerPort":"636"},"139846":{"opCountSearch":"88836","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"53424","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.179","connId":"139846","opCount":"88837","opCountDelete":"0","connServerPort":"636"},"139843":{"opCountSearch":"86877","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"58315","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.179","connId":"139843","opCount":"86878","opCountDelete":"0","connServerPort":"636"},"139844":{"opCountSearch":"20642","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"58316","opCountBind":"4385","opCountModify":"0","connBindDn":"cn=HQDOMAIN_CORNELL.WILLIAMSJR,ou=wstrust,ou=azure,ou=sso,o=view","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.179","connId":"139844","opCount":"25027","opCountDelete":"0","connServerPort":"636"},"139859":{"opCountSearch":"19583","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"58298","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.179","connId":"139859","opCount":"19584","opCountDelete":"0","connServerPort":"636"}},"aaeccabc-7af2-4fcf-b2db-020690112f5c":{"1355719":{"opCountSearch":"47412","opCountAdd":"0","opCountAbandon":"1999","connClientIp":"10.5.94.180","connClientPort":"63203","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"1355719","opCount":"49412","opCountDelete":"0","connServerPort":"2389"},"735889":{"opCountSearch":"0","opCountAdd":"806913","opCountAbandon":"0","connClientIp":"10.5.94.170","connClientPort":"52035","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"735889","opCount":"806914","opCountDelete":"0","connServerPort":"636"},"731969":{"opCountSearch":"50319","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.179","connClientPort":"53500","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"731969","opCount":"50320","opCountDelete":"0","connServerPort":"636"},"1373305":{"opCountSearch":"146","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.180","connClientPort":"53441","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"1373305","opCount":"147","opCountDelete":"0","connServerPort":"2389"},"876999":{"opCountSearch":"19585","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"58296","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"876999","opCount":"19586","opCountDelete":"0","connServerPort":"636"},"963210":{"opCountSearch":"17095","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"59455","opCountBind":"3384","opCountModify":"0","connBindDn":"cn=HQDOMAIN_JESSICA.ERVIN,ou=wstrust,ou=azure,ou=sso,o=view","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"963210","opCount":"20479","opCountDelete":"0","connServerPort":"636"},"731970":{"opCountSearch":"50319","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.179","connClientPort":"53499","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.180","connId":"731970","opCount":"50320","opCountDelete":"0","connServerPort":"2389"}},"a80969d3-0f8c-4e0f-9a09-0579e92023f1":{"969773":{"opCountSearch":"15582","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"51873","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969773","opCount":"15583","opCountDelete":"0","connServerPort":"636"},"969772":{"opCountSearch":"15582","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"51872","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969772","opCount":"15583","opCountDelete":"0","connServerPort":"636"},"1354802":{"opCountSearch":"350","opCountAdd":"342","opCountAbandon":"0","connClientIp":"10.5.94.180","connClientPort":"52738","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"1354802","opCount":"693","opCountDelete":"0","connServerPort":"2389"},"969771":{"opCountSearch":"15582","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"51867","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969771","opCount":"15583","opCountDelete":"0","connServerPort":"636"},"969770":{"opCountSearch":"15582","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"51866","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969770","opCount":"15583","opCountDelete":"0","connServerPort":"636"},"1354686":{"opCountSearch":"0","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"49371","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.apn-p-sso-ldap,OU=Service Account,OU=Users,OU=AsurionRoot,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"1354686","opCount":"1","opCountDelete":"0","connServerPort":"636"},"1354288":{"opCountSearch":"673","opCountAdd":"647","opCountAbandon":"0","connClientIp":"10.5.94.180","connClientPort":"62389","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"1354288","opCount":"1321","opCountDelete":"0","connServerPort":"2389"},"1354646":{"opCountSearch":"2171","opCountAdd":"2044","opCountAbandon":"0","connClientIp":"10.5.94.180","connClientPort":"50640","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"1354646","opCount":"4216","opCountDelete":"0","connServerPort":"2389"},"969810":{"opCountSearch":"15637","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"60458","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969810","opCount":"15638","opCountDelete":"0","connServerPort":"636"},"1354445":{"opCountSearch":"452","opCountAdd":"438","opCountAbandon":"0","connClientIp":"10.5.94.180","connClientPort":"64245","opCountBind":"1","opCountModify":"0","connBindDn":"cn=Directory Manager","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"1354445","opCount":"891","opCountDelete":"0","connServerPort":"2389"},"969809":{"opCountSearch":"15637","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"60457","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969809","opCount":"15638","opCountDelete":"0","connServerPort":"636"},"969808":{"opCountSearch":"15637","opCountAdd":"0","opCountAbandon":"0","connClientIp":"10.5.94.10","connClientPort":"60452","opCountBind":"1","opCountModify":"0","connBindDn":"CN=svc.us-p-sso-ldap,OU=SSO,OU=NA-Nashville,OU=service,OU=accounts,DC=int,DC=asurion,DC=com","opCountModifyDn":"0","opCountCompare":"0","connServerIp":"10.5.94.170","connId":"969808","opCount":"15638","opCountDelete":"0","connServerPort":"636"}}}'

		mock 'Invoke-VDSAdminAPIRestMethod' -MockWith { $JsonObject | ConvertFrom-Json}
        
        $Result = Get-VDSConnectionsInfo -Server 'vds.prod.asurion.net'
        $Result | Should -Be 'vds.prod.asurion.net'
    }
}